<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web IDE</title>
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .monaco-editor {
            height: 100%;
            width: 100%;
        }
        
        /* Mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            .sidebar {
                width: 200px;
            }
            .editor-container {
                width: calc(100% - 200px);
            }
        }
        
        /* VS Code-like scrollbar */
        ::-webkit-scrollbar {
            width: 14px;
            height: 14px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: #424242;
            border: 3px solid transparent;
            border-radius: 7px;
            background-clip: padding-box;
        }
        
        ::-webkit-scrollbar-track {
            background-color: transparent;
        }
        
        /* Dark mode styles */
        .dark {
            color-scheme: dark;
        }
    </style>
</head>
<body class="h-full bg-[#1e1e1e] text-white overflow-hidden">
    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center bg-[#1e1e1e]">
        <div class="bg-[#2d2d2d] p-8 rounded-lg shadow-xl w-96">
            <h2 class="text-2xl font-bold mb-6 text-center">GitHub Web IDE</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">GitHub Username</label>
                    <input type="text" id="github-username" class="w-full px-3 py-2 bg-[#3c3c3c] rounded border border-[#4c4c4c] focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Repository Name</label>
                    <input type="text" id="repo-name" class="w-full px-3 py-2 bg-[#3c3c3c] rounded border border-[#4c4c4c] focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">GitHub Client ID</label>
                    <input type="text" id="client-id" class="w-full px-3 py-2 bg-[#3c3c3c] rounded border border-[#4c4c4c] focus:outline-none focus:border-blue-500">
                </div>
                <button id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded">
                    Connect to GitHub
                </button>
            </div>
        </div>
    </div>

    <!-- Main IDE Interface -->
    <div id="ide" class="hidden h-full flex flex-col">
        <!-- Top Bar -->
        <div class="h-12 bg-[#2d2d2d] border-b border-[#1e1e1e] flex items-center px-4 justify-between">
            <div class="flex items-center space-x-4">
                <button id="menu-toggle" class="p-2 hover:bg-[#3c3c3c] rounded">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <span id="current-file" class="text-sm opacity-75">No file selected</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="save-btn" class="hidden px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 rounded">
                    Save
                </button>
                <button id="preview-btn" class="hidden px-3 py-1 text-sm bg-green-600 hover:bg-green-700 rounded">
                    Preview
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex">
            <!-- Sidebar -->
            <div id="sidebar" class="w-64 bg-[#252526] flex flex-col">
                <!-- File Explorer Header -->
                <div class="h-10 flex items-center justify-between px-4 bg-[#2d2d2d]">
                    <span class="text-sm font-medium">EXPLORER</span>
                    <button id="new-file-btn" class="p-1 hover:bg-[#3c3c3c] rounded">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </button>
                </div>
                <!-- File Tree -->
                <div id="file-tree" class="flex-1 overflow-y-auto p-2">
                    <!-- Files will be populated here -->
                </div>
            </div>

            <!-- Editor Container -->
            <div class="flex-1 flex flex-col">
                <div id="editor" class="flex-1"></div>
                <div id="preview" class="hidden flex-1 bg-white">
                    <iframe id="preview-frame" class="w-full h-full"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            github: {
                apiUrl: 'https://api.github.com',
                clientId: null,
                token: null
            }
        };

        // Initialize Monaco Editor
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            window.editor = monaco.editor.create(document.getElementById('editor'), {
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                lineNumbers: 'on',
                scrollBeyondLastLine: false,
                renderWhitespace: 'selection',
                tabSize: 2
            });
        });

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const ide = document.getElementById('ide');
        const loginBtn = document.getElementById('login-btn');
        const githubUsername = document.getElementById('github-username');
        const repoName = document.getElementById('repo-name');
        const clientId = document.getElementById('client-id');
        const saveBtn = document.getElementById('save-btn');
        const previewBtn = document.getElementById('preview-btn');
        const fileTree = document.getElementById('file-tree');
        const preview = document.getElementById('preview');
        const previewFrame = document.getElementById('preview-frame');
        const currentFile = document.getElementById('current-file');
        const newFileBtn = document.getElementById('new-file-btn');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');

        // Event Listeners
        loginBtn.addEventListener('click', handleLogin);
        saveBtn.addEventListener('click', handleSave);
        previewBtn.addEventListener('click', togglePreview);
        newFileBtn.addEventListener('click', createNewFile);
        menuToggle.addEventListener('click', toggleSidebar);

        // GitHub Authentication
        async function handleLogin() {
            const username = githubUsername.value;
            const repo = repoName.value;
            config.github.clientId = clientId.value;

            if (!username || !repo || !config.github.clientId) {
                alert('Please fill in all fields');
                return;
            }

            // In a real application, you would implement proper OAuth flow here
            // For demo purposes, we'll just show the IDE interface
            loginScreen.classList.add('hidden');
            ide.classList.remove('hidden');

            // Load repository files
            await loadRepositoryFiles(username, repo);
        }

        // File Operations
        async function loadRepositoryFiles(username, repo) {
            // In a real application, you would fetch files from GitHub API
            // For demo, we'll create some sample files
            const files = [
                { name: 'index.html', type: 'file', content: '<!DOCTYPE html><html><body><h1>Hello World</h1></body></html>' },
                { name: 'styles.css', type: 'file', content: 'body { color: blue; }' },
                { name: 'README.md', type: 'file', content: '# Project\nThis is a sample project.' }
            ];

            renderFileTree(files);
        }

        function renderFileTree(files) {
            fileTree.innerHTML = '';
            files.forEach(file => {
                const fileElement = createFileElement(file);
                fileTree.appendChild(fileElement);
            });
        }

        function createFileElement(file) {
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-2 p-1 hover:bg-[#2d2d2d] rounded cursor-pointer text-sm';
            
            const icon = document.createElement('span');
            icon.className = 'text-[#c5c5c5]';
            icon.textContent = file.type === 'file' ? '📄' : '📁';
            
            const name = document.createElement('span');
            name.textContent = file.name;
            
            div.appendChild(icon);
            div.appendChild(name);
            
            div.addEventListener('click', () => openFile(file));
            
            return div;
        }

        function openFile(file) {
            currentFile.textContent = file.name;
            window.editor.setValue(file.content);
            
            const isPreviewable = file.name.endsWith('.md') || file.name.endsWith('.html');
            previewBtn.classList.toggle('hidden', !isPreviewable);
            saveBtn.classList.remove('hidden');
            
            if (preview.classList.contains('flex')) {
                updatePreview();
            }
        }

        async function handleSave() {
            const content = window.editor.getValue();
            // In a real application, you would save to GitHub here
            alert('File saved successfully!');
        }

        function togglePreview() {
            const editorElement = document.getElementById('editor');
            preview.classList.toggle('hidden');
            preview.classList.toggle('flex');
            editorElement.classList.toggle('hidden');
            
            if (preview.classList.contains('flex')) {
                updatePreview();
            }
        }

        function updatePreview() {
            const content = window.editor.getValue();
            const fileName = currentFile.textContent;
            
            if (fileName.endsWith('.md')) {
                // For markdown, you would use a markdown parser here
                previewFrame.srcdoc = `<div style="padding: 20px;">${content}</div>`;
            } else if (fileName.endsWith('.html')) {
                previewFrame.srcdoc = content;
            }
        }

        function createNewFile() {
            const fileName = prompt('Enter file name:');
            if (fileName) {
                const file = { name: fileName, type: 'file', content: '' };
                const fileElement = createFileElement(file);
                fileTree.appendChild(fileElement);
                openFile(file);
            }
        }

        function toggleSidebar() {
            sidebar.classList.toggle('hidden');
        }

        // Mobile optimization
        function checkOrientation() {
            if (window.matchMedia("(max-width: 768px)").matches) {
                if (window.orientation === 0) {
                    alert('Please rotate your device to landscape mode for better experience');
                }
            }
        }

        window.addEventListener('load', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
    </script>
</body>
</html>
    <div id="app" class="hidden h-full flex flex-col">
      <!-- Navigation Bar -->
      <nav class="bg-white dark:bg-gray-800 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16">
            <div class="flex items-center">
              <div class="flex-shrink-0 flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-8 w-8 text-gray-800 dark:text-gray-200"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
                  ></path>
                </svg>
                <span
                  class="ml-2 text-xl font-bold text-gray-900 dark:text-white"
                  >MD Editor</span
                >
              </div>
            </div>

            <div class="flex-1 flex items-center justify-center px-6">
              <div id="repo-selector" class="w-full max-w-md relative">
                <button
                  id="repo-dropdown-btn"
                  class="w-full flex items-center justify-between pl-3 pr-10 py-2 text-left bg-white dark:bg-gray-700 rounded-md border border-gray-300 dark:border-gray-600 shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500"
                >
                  <span id="current-repo-name" class="block truncate dark:text-white">Select Repository</span>
                  <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </span>
                </button>
                <div
                  id="repo-dropdown-content"
                  class="hidden absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                >
                  <!-- Repository list will be populated here -->
                </div>
              </div>
            </div>

            <div class="flex items-center space-x-4">
              <div id="branch-selector" class="relative hidden">
                <button
                  id="branch-dropdown-btn"
                  class="flex items-center text-sm px-3 py-1 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
                >
                  <svg class="mr-1.5 h-4 w-4 text-gray-500 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 3v12"></path>
                    <circle cx="18" cy="6" r="3"></circle>
                    <circle cx="6" cy="18" r="3"></circle>
                    <path d="M18 9a9 9 0 0 1-9 9"></path>
                  </svg>
                  <span id="current-branch">main</span>
                  <svg class="ml-1.5 h-4 w-4 text-gray-500 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
                <div
                  id="branch-dropdown-content"
                  class="hidden absolute right-0 z-10 mt-1 w-48 bg-white dark:bg-gray-800 shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                >
                  <!-- Branch list will be populated here -->
                </div>
              </div>

              <button
                id="theme-toggle"
                class="p-2 rounded-md text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white"
              >
                <svg
                  id="dark-icon"
                  class="h-5 w-5"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                  />
                </svg>
                <svg
                  id="light-icon"
                  class="h-5 w-5 hidden"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                  />
                </svg>
              </button>

              <div class="ml-3 relative">
                <div>
                  <button
                    id="user-menu-button"
                    class="flex items-center space-x-2 text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                  >
                    <img
                      id="user-avatar"
                      class="h-8 w-8 rounded-full"
                      src="/api/placeholder/32/32"
                      alt="User"
                    />
                    <span id="user-name" class="hidden sm:block text-sm font-medium text-gray-700 dark:text-gray-300">User</span>
                  </button>
                </div>
                <div
                  id="user-dropdown"
                  class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-10"
                >
                  <div class="px-4 py-2 text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700">
                    <p class="font-medium" id="dropdown-user-name">Username</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate" id="dropdown-user-email">email@example.com</p>
                  </div>
                  <a
                    href="#"
                    id="logout-btn"
                    class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
                    >Sign out</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside
          class="w-64 flex-shrink-0 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex flex-col"
        >
          <div class="p-4 flex flex-col">
            <div class="flex justify-between items-center">
              <h2 class="text-lg font-medium text-gray-900 dark:text-white">
                Files
              </h2>
              <div class="flex space-x-1">
                <button
                  id="refresh-files-btn"
                  class="p-1 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  title="Refresh"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                  </svg>
                </button>
                <button
                  id="new-file-btn"
                  class="p-1 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  title="New File"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </button>
              </div>
            </div>
            <div class="mt-2">
              <div class="relative rounded-md shadow-sm">
                <input
                  id="search-input"
                  class="block w-full pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-900 dark:text-white"
                  placeholder="Search files..."
                  type="search"
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
          <div class="border-t border-gray-200 dark:border-gray-700"></div>
          <div class="overflow-y-auto flex-1">
            <div id="file-path-breadcrumb" class="px-4 py-2 text-sm text-gray-500 dark:text-gray-400"></div>
            <ul id="file-list" class="py-2"></ul>
          </div>
        </aside>

        <!-- Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
          <div id="editor-container" class="hidden flex-1 flex flex-col">
            <div
              class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4 flex justify-between items-center"
            >
              <div class="flex items-center space-x-2">
                <input
                  id="file-name-input"
                  class="text-lg font-medium py-1 px-2 border border-transparent rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-transparent text-gray-900 dark:text-white"
                  readonly
                />
                <button
                  id="rename-file-btn"
                  class="p-1 rounded-md text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                    />
                  </svg>
                </button>
              </div>
              <div class="flex space-x-2">
                <div id="commit-container" class="hidden sm:flex items-center mr-2">
                  <input 
                    type="text" 
                    id="commit-message" 
                    placeholder="Commit message" 
                    class="text-sm border border-gray-300 dark:border-gray-600 rounded-md py-1 px-2 w-48 mr-2 dark:bg-gray-700 dark:text-white"
                  >
                </div>
                <button
                  id="save-btn"
                  class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                >
                  Commit Changes
                </button>
                <button
                  id="preview-toggle"
                  class="inline-flex items-center px-3 py-1 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                >
                  Preview
                </button>
              </div>
            </div>
            <div class="flex-1 flex overflow-hidden">
              <div id="editor-view" class="flex-1 overflow-hidden"></div>
              <div
                id="preview-view"
                class="hidden flex-1 overflow-y-auto p-6 bg-white dark:bg-gray-800"
              >
                <div
                  id="preview-content"
                  class="markdown-body max-w-3xl mx-auto prose dark:prose-invert"
                ></div>
              </div>
            </div>
          </div>
          <div
            id="welcome-view"
            class="flex-1 flex items-center justify-center p-6 bg-gray-50 dark:bg-gray-900"
          >
            <div class="text-center max-w-md">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-16 w-16 mx-auto text-gray-800 dark:text-gray-200"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
                ></path>
              </svg>
              <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-white">
                Select a Repository
              </h2>
              <p class="mt-2 text-gray-600 dark:text-gray-400">
                Choose a repository from the dropdown above to start editing markdown files.
              </p>
              <div id="repo-selection-guide" class="mt-6">
                <button
                  id="repo-selection-btn"
                  class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                >
                  Select Repository
                </button>
              </div>
            </div>
          </div>
          <div
            id="empty-repo-view"
            class="hidden flex-1 flex items-center justify-center p-6 bg-gray-50 dark:bg-gray-900"
          >
            <div class="text-center max-w-md">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-16 w-16 mx-auto text-gray-600 dark:text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
                />
              </svg>
              <h2 class="mt-4 text-xl font-bold text-gray-900 dark:text-white">
                No Markdown Files Found
              </h2>
              <p class="mt-2 text-gray-600 dark:text-gray-400">
                This repository doesn't have any markdown files. Create a new markdown file to get started.
              </p>
              <button
                id="create-first-file-btn"
                class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
              >
                Create New File
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- New File Modal -->
    <div id="new-file-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
      <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
        </div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-blue-600 dark:text-blue-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modal-title">
                  Create New File
                </h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    Enter a name for the new file. The file will be created in the current directory.
                  </p>
                  <div class="mt-4">
                    <input
                      type="text"
                      id="new-file-name"
                      class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md p-2 dark:bg-gray-700 dark:text-white"
                      placeholder="filename.md"
                    />
                    <div id="new-file-error" class="mt-1 text-sm text-red-600 hidden"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              id="create-file-confirm"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Create
            </button>
            <button
              type="button"
              id="create-file-cancel"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Commit Modal -->
    <div id="commit-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
      <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
        </div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-green-600 dark:text-green-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modal-title">
                  Commit Changes
                </h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    Enter a commit message to describe your changes.
                  </p>
                  <div class="mt-4">
                    <input
                      type="text"
                      id="modal-commit-message"
                      class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md p-2 dark:bg-gray-700 dark:text-white"
                      placeholder="Update README.md"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              id="commit-confirm"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Commit
            </button>
            <button
              type="button"
              id="commit-cancel"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 z-50 rounded-md shadow-md p-4 bg-white dark:bg-gray-800 hidden transform transition-all duration-300 opacity-0 translate-y-2">
      <div class="flex items-center">
        <div id="toast-icon-success" class="flex-shrink-0 hidden">
          <svg class="h-6 w-6 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <div id="toast-icon-error" class="flex-shrink-0 hidden">
          <svg class="h-6 w-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </div>
        <div id="toast-icon-info" class="flex-shrink-0 hidden">
          <svg class="h-6 w-6 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div id="toast-message" class="ml-3 text-sm font-medium text-gray-900 dark:text-white">
          Action completed successfully!
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let editor;
      let currentFile = null;
      let currentRepo = null;
      let currentBranch = "main";
      let currentPath = "";
      let isFileModified = false;
      let demoRepos = [
        {
          name: "example/markdown-docs",
          description: "Example Markdown Documentation",
          files: [
            {
              name: "README.md",
              path: "README.md",
              content: "# Markdown Documentation\n\nThis is a sample repository for demonstrating the Markdown Editor.\n\n## Features\n\n- **Live Preview**: See your changes as you type\n- **GitHub Flavored**: Supports GitHub Flavored Markdown\n- **Dark Mode**: Easy on the eyes\n- **File Management**: Create, edit, and organize markdown files\n\n## Getting Started\n\nChoose a file from the sidebar to start editing, or create a new file using the + button.\n\n---\n\n*This is a demo repository for the GitHub Markdown Editor.*",
              type: "file"
            },
            {
              name: "guides",
              path: "guides",
              type: "dir",
              children: [
                {
                  name: "getting-started.md",
                  path: "guides/getting-started.md",
                  content: "# Getting Started\n\nWelcome to the Markdown Editor! This guide will help you get started with using the editor.\n\n## Basic Usage\n\n1. **Select a Repository**: Choose a repository from the dropdown menu\n2. **Select a File**: Click on a markdown file in the sidebar to open it\n3. **Edit Content**: Make changes to the file in the editor\n4. **Preview**: Toggle between edit and preview modes\n5. **Save**: Commit your changes with a commit message\n\n## Markdown Basics\n\n### Headers\n\n```markdown\n# Header 1\n## Header 2\n### Header 3\n```\n\n### Lists\n\n```markdown\n- Item 1\n- Item 2\n  - Nested item\n```\n\n### Links\n\n```markdown\n[Link text](https://example.com)\n```\n\n### Images\n\n```markdown\n![Alt text](image-url.jpg)\n```\n\nEnjoy using the Markdown Editor!",
                  type: "file"
                },
                {
                  name: "advanced.md",
                  path: "guides/advanced.md",
                  content: "# Advanced Features\n\n## Code Blocks\n\nCreate code blocks with syntax highlighting:\n\n```javascript\nfunction hello() {\n  console.log('Hello, world!');\n}\n```\n\n## Tables\n\n| Header 1 | Header 2 |\n|----------|----------|\n| Cell 1   | Cell 2   |\n| Cell 3   | Cell 4   |\n\n## Task Lists\n\n- [x] Completed task\n- [ ] Incomplete task\n\n## Footnotes\n\nHere's a sentence with a footnote. [^1]\n\n[^1]: This is the footnote.\n\n## Strikethrough\n\n~~This text is crossed out.~~\n\n## Blockquotes\n\n> This is a blockquote\n> \n> It can span multiple lines",
                  type: "file"
                }
              ]
            },
            {
              name: "examples",
              path: "examples",
              type: "dir",
              children: [
                {
                  name: "example1.md",
                  path: "examples/example1.md",
                  content: "# Example Document\n\nThis is an example of a Markdown document.\n\n## Section 1\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in dui mauris. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim.\n\n## Section 2\n\n- Item 1\n- Item 2\n- Item 3\n\n### Subsection\n\n1. First item\n2. Second item\n3. Third item\n\n## Code Example\n\n```javascript\nfunction greet() {\n  console.log(\"Hello, world!\");\n}\n\ngreet();\n```\n\n## Table\n\n| Name  | Age | Occupation |\n|-------|-----|------------|\n| John  | 32  | Developer  |\n| Sarah | 28  | Designer   |\n| Mike  | 45  | Manager    |\n\n## Links\n\n[GitHub](https://github.com)\n\n## Image\n\n![Markdown Logo](https://markdown-here.com/img/icon256.png)\n\n## Blockquote\n\n> The greatest glory in living lies not in never falling, but in rising every time we fall.\n\n## Horizontal Rule\n\n---\n\n**Bold text** and *italic text*.",
                  type: "file"
                },
                {
                  name: "example2.md",
                  path: "examples/example2.md",
                  content: "# Another Example\n\nThis is another example document to show more Markdown features.\n\n## Math Equations\n\nWhen rendered with a compatible Markdown viewer, the following would show math equations:\n\n```\n$$ E = mc^2 $$\n```\n\n## Diagrams\n\nSome Markdown viewers support diagrams:\n\n```mermaid\ngraph TD;\n    A-->B;\n    A-->C;\n    B-->D;\n    C-->D;\n```\n\n## Emojis\n\nYou can use emoji shortcodes in GitHub Flavored Markdown:\n\n:smile: :heart: :thumbsup: :rocket:\n\n## Keyboard Keys\n\n<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Delete</kbd>\n\n## Abbreviations\n\nHTML is an abbreviation.\n\n*[HTML]: Hyper Text Markup Language\n\n## Definition Lists\n\nTerm 1\n: Definition 1\n\nTerm 2\n: Definition 2a\n: Definition 2b\n\n## Collapsible Sections\n\n<details>\n<summary>Click to expand!</summary>\n\n### Hidden content\n\nThis content is hidden until the section is expanded.\n</details>",
                  type: "file"
                }
              ]
            }
          ]
        },
        {
          name: "example/project-docs",
          description: "Project Documentation",
          files: [
            {
              name: "README.md",
              path: "README.md",
              content: "# Project Documentation\n\nWelcome to the project documentation repository!\n\n## Overview\n\nThis repository contains documentation for the project, including user guides, API references, and developer documentation.\n\n## Navigation\n\n- [User Guide](user-guide.md)\n- [API Reference](api-reference.md)\n- [Developer Documentation](developer-docs.md)\n\n## Contributing\n\nContributions to the documentation are welcome! Please follow the [contribution guidelines](CONTRIBUTING.md).",
              type: "file"
            },
            {
              name: "user-guide.md",
              path: "user-guide.md",
              content: "# User Guide\n\n## Introduction\n\nWelcome to the user guide for our project. This guide will help you get started with using the application.\n\n## Installation\n\n```bash\nnpm install our-project\n```\n\n## Configuration\n\nCreate a configuration file at `config.json` with the following structure:\n\n```json\n{\n  \"apiKey\": \"your-api-key\",\n  \"endpoint\": \"https://api.example.com\",\n  \"timeout\": 5000\n}\n```\n\n## Basic Usage\n\n```javascript\nconst project = require('our-project');\n\nproject.init();\nproject.doSomething();\n```\n\n## Advanced Features\n\n### Feature 1\n\nDescription of feature 1...\n\n### Feature 2\n\nDescription of feature 2...\n\n## Troubleshooting\n\n### Common Issues\n\n- **Issue 1**: Solution for issue 1\n- **Issue 2**: Solution for issue 2\n\n## Support\n\nIf you need help, please [open an issue](https://github.com/example/project/issues).",
              type: "file"
            },
            {
              name: "api-reference.md",
              path: "api-reference.md",
              content: "# API Reference\n\n## Endpoints\n\n### GET /api/items\n\nReturns a list of items.\n\n**Parameters:**\n\n| Name | Type | Description |\n|------|------|-------------|\n| page | integer | Page number |\n| limit | integer | Items per page |\n\n**Response:**\n\n```json\n{\n  \"items\": [\n    {\n      \"id\": 1,\n      \"name\": \"Item 1\",\n      \"description\": \"Description of item 1\"\n    },\n    {\n      \"id\": 2,\n      \"name\": \"Item 2\",\n      \"description\": \"Description of item 2\"\n    }\n  ],\n  \"total\": 10,\n  \"page\": 1,\n  \"limit\": 2\n}\n```\n\n### POST /api/items\n\nCreates a new item.\n\n**Request Body:**\n\n```json\n{\n  \"name\": \"New Item\",\n  \"description\": \"Description of new item\"\n}\n```\n\n**Response:**\n\n```json\n{\n  \"id\": 3,\n  \"name\": \"New Item\",\n  \"description\": \"Description of new item\",\n  \"createdAt\": \"2023-01-01T00:00:00Z\"\n}\n```\n\n## Authentication\n\nAll API endpoints require authentication. Include an `Authorization` header with a Bearer token:\n\n```\nAuthorization: Bearer your-api-token\n```\n\n## Error Handling\n\nErrors are returned as JSON objects with the following structure:\n\n```json\n{\n  \"error\": {\n    \"code\": \"invalid_request\",\n    \"message\": \"Invalid request parameters\"\n  }\n}\n```\n\n## Rate Limiting\n\nAPI requests are limited to 100 requests per minute per IP address.",
              type: "file"
            },
            {
              name: "developer-docs.md",
              path: "developer-docs.md",
              content: "# Developer Documentation\n\n## Project Structure\n\n```\n/src\n  /api\n    - controllers/\n    - models/\n    - routes/\n  /config\n  /utils\n  index.js\n/tests\n/docs\n```\n\n## Development Setup\n\n1. Clone the repository:\n   ```bash\n   git clone https://github.com/example/project.git\n   cd project\n   ```\n\n2. Install dependencies:\n   ```bash\n   npm install\n   ```\n\n3. Set up environment variables:\n   ```bash\n   cp .env.example .env\n   ```\n   Then edit `.env` with your specific configuration.\n\n4. Start the development server:\n   ```bash\n   npm run dev\n   ```\n\n## Testing\n\n```bash\nnpm test\n```\n\nTo run tests with coverage:\n\n```bash\nnpm run test:coverage\n```\n\n## Build\n\n```bash\nnpm run build\n```\n\nThe built files will be in the `dist/` directory.\n\n## Deployment\n\n### Docker\n\n```bash\ndocker build -t project-name .\ndocker run -p 3000:3000 project-name\n```\n\n### Manual Deployment\n\n1. Build the project\n2. Copy the `dist/` directory to your server\n3. Install production dependencies:\n   ```bash\n   npm install --production\n   ```\n4. Start the server:\n   ```bash\n   npm start\n   ```\n\n## Contribution Guidelines\n\n1. Fork the repository\n2. Create a new branch for your feature\n3. Write tests for your feature\n4. Implement your feature\n5. Submit a pull request\n\n## Code Style\n\nWe use ESLint and Prettier to maintain code quality. Run linting with:\n\n```bash\nnpm run lint\n```\n\nFix linting issues automatically:\n\n```bash\nnpm run lint:fix\n```",
              type: "file"
            },
            {
              name: "CONTRIBUTING.md",
              path: "CONTRIBUTING.md",
              content: "# Contributing Guidelines\n\nThank you for your interest in contributing to our project! This document provides guidelines and instructions for contributing.\n\n## Code of Conduct\n\nPlease read and follow our [Code of Conduct](CODE_OF_CONDUCT.md).\n\n## How to Contribute\n\n### Reporting Bugs\n\n- Before submitting a bug report, please check the issue tracker to avoid duplicates\n- Use the bug report template when creating a new issue\n- Include detailed steps to reproduce the bug\n- Include screenshots if applicable\n- Include your environment details (OS, browser, etc.)\n\n### Suggesting Features\n\n- Before submitting a feature request, please check the issue tracker and discussions\n- Use the feature request template when creating a new issue\n- Clearly describe the problem the feature would solve\n- Suggest a solution if possible\n\n### Pull Requests\n\n1. Fork the repository\n2. Create a new branch for your changes\n3. Make your changes\n4. Write or update tests as necessary\n5. Run tests and ensure they pass\n6. Update documentation as necessary\n7. Submit a pull request\n\n### Pull Request Process\n\n1. Update the README.md with details of changes if applicable\n2. Update the docs/ folder with any new documentation\n3. The PR will be merged once it has been reviewed and approved\n\n## Development Setup\n\nSee the [Developer Documentation](developer-docs.md) for detailed setup instructions.\n\n## Style Guidelines\n\n### Code Style\n\n- Follow the coding style already present in the codebase\n- Use meaningful variable and function names\n- Comment your code when necessary\n- Write clear commit messages\n\n### Commit Messages\n\nWe follow the [Conventional Commits](https://www.conventionalcommits.org/) specification:\n\n- `feat`: A new feature\n- `fix`: A bug fix\n- `docs`: Documentation changes\n- `style`: Code style changes (formatting, etc.)\n- `refactor`: Code refactoring\n- `test`: Adding or updating tests\n- `chore`: Maintenance tasks\n\nExample: `feat: add user authentication`\n\n## License\n\nBy contributing, you agree that your contributions will be licensed under the project's license.",
              type: "file"
            }
          ]
        }
      ];
      
      // DOM Elements
      const body = document.getElementById('body');
      const loginScreen = document.getElementById('login-screen');
      const app = document.getElementById('app');
      const editorContainer = document.getElementById('editor-container');
      const welcomeView = document.getElementById('welcome-view');
      const emptyRepoView = document.getElementById('empty-repo-view');
      const fileList = document.getElementById('file-list');
      const repoDropdownBtn = document.getElementById('repo-dropdown-btn');
      const repoDropdownContent = document.getElementById('repo-dropdown-content');
      const currentRepoName = document.getElementById('current-repo-name');
      const fileNameInput = document.getElementById('file-name-input');
      const editorView = document.getElementById('editor-view');
      const previewView = document.getElementById('preview-view');
      const previewContent = document.getElementById('preview-content');
      const previewToggle = document.getElementById('preview-toggle');
      const saveBtn = document.getElementById('save-btn');
      const newFileBtn = document.getElementById('new-file-btn');
      const createFirstFileBtn = document.getElementById('create-first-file-btn');
      const refreshFilesBtn = document.getElementById('refresh-files-btn');
      const searchInput = document.getElementById('search-input');
      const branchSelector = document.getElementById('branch-selector');
      const branchDropdownBtn = document.getElementById('branch-dropdown-btn');
      const branchDropdownContent = document.getElementById('branch-dropdown-content');
      const currentBranchSpan = document.getElementById('current-branch');
      const renameFileBtn = document.getElementById('rename-file-btn');
      const userMenuButton = document.getElementById('user-menu-button');
      const userDropdown = document.getElementById('user-dropdown');
      const logoutBtn = document.getElementById('logout-btn');
      const userAvatar = document.getElementById('user-avatar');
      const userName = document.getElementById('user-name');
      const dropdownUserName = document.getElementById('dropdown-user-name');
      const dropdownUserEmail = document.getElementById('dropdown-user-email');
      const themeToggle = document.getElementById('theme-toggle');
      const darkIcon = document.getElementById('dark-icon');
      const lightIcon = document.getElementById('light-icon');
      const newFileModal = document.getElementById('new-file-modal');
      const newFileNameInput = document.getElementById('new-file-name');
      const newFileError = document.getElementById('new-file-error');
      const createFileConfirm = document.getElementById('create-file-confirm');
      const createFileCancel = document.getElementById('create-file-cancel');
      const commitModal = document.getElementById('commit-modal');
      const modalCommitMessage = document.getElementById('modal-commit-message');
      const commitConfirm = document.getElementById('commit-confirm');
      const commitCancel = document.getElementById('commit-cancel');
      const commitMessage = document.getElementById('commit-message');
      const commitContainer = document.getElementById('commit-container');
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastIconSuccess = document.getElementById('toast-icon-success');
      const toastIconError = document.getElementById('toast-icon-error');
      const toastIconInfo = document.getElementById('toast-icon-info');
      const githubLoginBtn = document.getElementById('github-login-btn');
      const demoLoginBtn = document.getElementById('demo-login-btn');
      const repoSelectionBtn = document.getElementById('repo-selection-btn');
      const filePathBreadcumb = document.getElementById('file-path-breadcrumb');
      const  enterDemoMode= document.getElementById('demo-login-btn');
      
      
      // Let's implement the GitHub OAuth authentication flow
// Add these script functions after the existing script in the HTML file

document.addEventListener('DOMContentLoaded', function() {
  // Initialize the application
  initApp();
});

function initApp() {
  // Set up event listeners
  setupEventListeners();
  
  // Check if there's a GitHub OAuth code in the URL (for when returning from GitHub auth)
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');
  
  if (code) {
    // Remove the code from the URL to prevent issues on refresh
    window.history.replaceState({}, document.title, window.location.pathname);
    
    // Handle the GitHub authentication
    handleGitHubAuth(code);
  } else {
    // Check if we have a saved token
    const token = localStorage.getItem('github_token');
    if (token) {
      // We're already authenticated
      authenticateWithToken(token);
    }
  }
}

function setupEventListeners() {
  // Helper function to safely add event listeners
  function addEventIfElementExists(elementId, event, handler) {
    const element = document.getElementById(elementId);
    if (element) {
      element.addEventListener(event, handler);
    } else {
      console.warn(`Element with ID ${elementId} not found`);
    }
  }
  
  // Get references to frequently used elements
  const repoSelectionBtn = document.getElementById('repo-selection-btn');
  const repoDropdownBtn = document.getElementById('repo-dropdown-btn');
  const repoDropdownContent = document.getElementById('repo-dropdown-content');
  const branchDropdownContent = document.getElementById('branch-dropdown-content');
  const searchInput = document.getElementById('search-input');
  const fileNameInput = document.getElementById('file-name-input');
  const userDropdown = document.getElementById('user-dropdown');
  
  // Setup GitHub login button
  addEventIfElementExists('github-login-btn', 'click', initiateGitHubLogin);
  
  // Setup demo mode button
  addEventIfElementExists('demo-login-btn', 'click', initDemoMode);
  
  // Setup repo selection button in welcome view
  if (repoSelectionBtn && repoDropdownBtn) {
    repoSelectionBtn.addEventListener('click', function() {
      repoDropdownBtn.click();
    });
  }
  
  // Setup repository dropdown
  addEventIfElementExists('repo-dropdown-btn', 'click', toggleRepoDropdown);
  
  // Setup branch dropdown
  addEventIfElementExists('branch-dropdown-btn', 'click', toggleBranchDropdown);
  
  // Setup theme toggle
  addEventIfElementExists('theme-toggle', 'click', toggleTheme);
  
  // Setup user menu
  addEventIfElementExists('user-menu-button', 'click', toggleUserDropdown);
  
  // Setup logout button
  addEventIfElementExists('logout-btn', 'click', handleLogout);
  
  // Setup preview toggle
  addEventIfElementExists('preview-toggle', 'click', togglePreview);
  
  // Setup save button
  addEventIfElementExists('save-btn', 'click', saveChanges);
  
  // Setup new file button
  addEventIfElementExists('new-file-btn', 'click', showNewFileModal);
  
  // Setup create first file button
  addEventIfElementExists('create-first-file-btn', 'click', showNewFileModal);
  
  // Setup refresh files button
  addEventIfElementExists('refresh-files-btn', 'click', refreshFiles);
  
  // Setup search input
  if (searchInput) {
    searchInput.addEventListener('input', filterFiles);
  }
  
  // Setup rename file button
  addEventIfElementExists('rename-file-btn', 'click', toggleFileNameEdit);
  
  // Setup file name input
  if (fileNameInput) {
    fileNameInput.addEventListener('blur', handleFileNameChange);
    fileNameInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        this.blur();
      }
    });
  }
  
  // Setup modal buttons
  addEventIfElementExists('create-file-confirm', 'click', handleCreateFile);
  addEventIfElementExists('create-file-cancel', 'click', closeNewFileModal);
  addEventIfElementExists('commit-confirm', 'click', handleCommitChanges);
  addEventIfElementExists('commit-cancel', 'click', closeCommitModal);
  
  // Setup editor change event
  document.addEventListener('editorChanged', function() {
    if (typeof isFileModified !== 'undefined' && currentFile) {
      isFileModified = true;
      document.title = `*${currentFile.name} - MD Editor`;
    }
  });
  
  // Close dropdowns when clicking elsewhere
  document.addEventListener('click', function(e) {
    // If clicking outside the repo dropdown
    if (repoDropdownContent && 
        !e.target.closest('#repo-selector') && 
        repoDropdownContent.classList.contains('block')) {
      repoDropdownContent.classList.replace('block', 'hidden');
    }
    
    // If clicking outside the branch dropdown
    if (branchDropdownContent && 
        !e.target.closest('#branch-selector') && 
        branchDropdownContent.classList.contains('block')) {
      branchDropdownContent.classList.replace('block', 'hidden');
    }
    
    // If clicking outside the user dropdown
    if (userDropdown && 
        !e.target.closest('#user-menu-button') && 
        !e.target.closest('#user-dropdown') && 
        userDropdown.classList.contains('block')) {
      userDropdown.classList.replace('block', 'hidden');
    }
  });
  
  // Setup keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + S to save
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      saveChanges();
    }
    
    // Ctrl/Cmd + P to preview
    if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
      e.preventDefault();
      togglePreview();
    }
  });
  
  // Handle window beforeunload to warn about unsaved changes
  window.addEventListener('beforeunload', function(e) {
    if (typeof isFileModified !== 'undefined' && isFileModified) {
      const message = 'You have unsaved changes that will be lost if you leave.';
      e.returnValue = message;
      return message;
    }
  });
}







function initiateGitHubLogin() {
  // GitHub OAuth configuration
  const clientId = 'Ov23liGkKAgdipFL14fp'; // Replace with actual client ID
  const redirectUri = window.location.origin + window.location.pathname;
  const scope = 'repo user';
  
  // Construct the GitHub OAuth URL
  const authUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scope}`;
  
  // Redirect to GitHub for authentication
  window.location.href = authUrl;
}

function handleGitHubAuth(code) {
  // Note: In a real application, you would exchange this code for an access token
  // using a server-side endpoint to keep your client secret secure
  
  // For demo purposes, we'll simulate a successful authentication
  showToast('Authenticating with GitHub...', 'info');
  
  // In a real app, this would be a fetch to your backend that exchanges the code for a token
  // For this demo, we'll simulate a successful authentication after a delay
  setTimeout(() => {
    const mockToken = 'mock_github_token_' + Math.random().toString(36).substring(2);
    localStorage.setItem('github_token', mockToken);
    authenticateWithToken(mockToken);
  }, 1500);
}

function authenticateWithToken(token) {
  // In a real app, we would validate the token and get user info
  // For demo purposes, we'll create a mock user
  const user = {
    login: 'Manojkumbi',
    name: 'Manoj Kumar',
    email: 'manoj@example.com',
    avatar_url: 'https://avatars.githubusercontent.com/u/12345678'
  };
  
  // Update UI to show user info
  updateUserInfo(user);
  
  // Fetch repositories
  fetchUserRepositories(token);
  
  // Show the app UI
  loginScreen.classList.add('hidden');
  app.classList.remove('hidden');
  
  showToast('Successfully logged in!', 'success');
}

function fetchUserRepositories(token) {
  // In a real app, we would fetch the user's repositories from GitHub API
  // For this demo, we'll simulate fetching repositories
  
  // Clear existing repositories
  repoDropdownContent.innerHTML = '';
  
  // Add demo repositories
  const repositories = [
    {
      name: 'Manojkumbi/mdeditor',
      description: 'GitHub Markdown Editor',
      private: false
    },
    {
      name: 'Manojkumbi/project-docs',
      description: 'Project Documentation',
      private: false
    },
    {
      name: 'Manojkumbi/personal-notes',
      description: 'Personal Notes and Documentation',
      private: true
    }
  ];
  
  // Populate the repository dropdown
  repositories.forEach(repo => {
    const repoItem = document.createElement('div');
    repoItem.className = 'px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer repo-item flex justify-between items-center';
    
    const repoInfo = document.createElement('div');
    repoInfo.className = 'flex-1';
    
    const repoName = document.createElement('div');
    repoName.className = 'text-sm font-medium text-gray-900 dark:text-white';
    repoName.textContent = repo.name;
    
    const repoDesc = document.createElement('div');
    repoDesc.className = 'text-xs text-gray-500 dark:text-gray-400 truncate';
    repoDesc.textContent = repo.description;
    
    repoInfo.appendChild(repoName);
    repoInfo.appendChild(repoDesc);
    
    const repoStatus = document.createElement('div');
    repoStatus.className = 'ml-2 flex-shrink-0';
    
    if (repo.private) {
      const lockIcon = document.createElement('svg');
      lockIcon.className = 'h-4 w-4 text-gray-400 dark:text-gray-500';
      lockIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      lockIcon.setAttribute('viewBox', '0 0 20 20');
      lockIcon.setAttribute('fill', 'currentColor');
      
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('fill-rule', 'evenodd');
      path.setAttribute('d', 'M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z');
      path.setAttribute('clip-rule', 'evenodd');
      
      lockIcon.appendChild(path);
      repoStatus.appendChild(lockIcon);
    }
    
    repoItem.appendChild(repoInfo);
    repoItem.appendChild(repoStatus);
    
    repoItem.addEventListener('click', function() {
      selectRepository(repo.name);
    });
    
    repoDropdownContent.appendChild(repoItem);
  });
}

function selectRepository(repoName) {
  currentRepo = repoName;
  currentRepoName.textContent = repoName;
  repoDropdownContent.classList.replace('block', 'hidden');
  
  // Show loading state
  welcomeView.classList.add('hidden');
  emptyRepoView.classList.add('hidden');
  editorContainer.classList.add('hidden');
  
  // Clear current file path
  currentPath = '';
  
  // Fetch repository branches
  fetchRepositoryBranches(repoName);
  
  // Fetch repository files
  fetchRepositoryFiles(repoName, currentBranch, currentPath);
}

function fetchRepositoryBranches(repoName) {
  // In a real app, we would fetch branches from GitHub API
  // For this demo, we'll simulate fetching branches
  
  // Show branch selector
  branchSelector.classList.remove('hidden');
  
  // Clear existing branches
  branchDropdownContent.innerHTML = '';
  
  // Add demo branches
  const branches = ['main', 'develop', 'feature/new-design'];
  
  // Set current branch
  currentBranch = 'main';
  currentBranchSpan.textContent = currentBranch;
  
  // Populate the branch dropdown
  branches.forEach(branch => {
    const branchItem = document.createElement('div');
    branchItem.className = 'px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
    branchItem.textContent = branch;
    
    // Add active branch indicator
    if (branch === currentBranch) {
      branchItem.classList.add('bg-gray-100', 'dark:bg-gray-700');
      
      const checkIcon = document.createElement('span');
      checkIcon.className = 'absolute inset-y-0 right-4 flex items-center';
      
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('class', 'h-4 w-4 text-indigo-500');
      svg.setAttribute('viewBox', '0 0 20 20');
      svg.setAttribute('fill', 'currentColor');
      
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('fill-rule', 'evenodd');
      path.setAttribute('d', 'M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z');
      path.setAttribute('clip-rule', 'evenodd');
      
      svg.appendChild(path);
      checkIcon.appendChild(svg);
      branchItem.appendChild(checkIcon);
    }
    
    branchItem.addEventListener('click', function() {
      selectBranch(branch);
    });
    
    branchDropdownContent.appendChild(branchItem);
  });
}

function selectBranch(branch) {
  if (branch !== currentBranch) {
    currentBranch = branch;
    currentBranchSpan.textContent = currentBranch;
    branchDropdownContent.classList.replace('block', 'hidden');
    
    // Fetch repository files for the selected branch
    fetchRepositoryFiles(currentRepo, currentBranch, currentPath);
  } else {
    branchDropdownContent.classList.replace('block', 'hidden');
  }
}

function fetchRepositoryFiles(repoName, branch, path) {
  // In a real app, we would fetch files from GitHub API
  // For this demo, we'll use our demo repositories
  
  showToast('Loading repository files...', 'info');
  
  // Simulate API delay
  setTimeout(() => {
    let repo;
    
    // Find the matching demo repo
    if (repoName === 'Manojkumbi/mdeditor') {
      repo = demoRepos[0];
    } else if (repoName === 'Manojkumbi/project-docs') {
      repo = demoRepos[1];
    } else if (repoName === 'Manojkumbi/personal-notes') {
      // Create a new demo repo for personal notes
      repo = {
        name: 'Manojkumbi/personal-notes',
        description: 'Personal Notes and Documentation',
        files: [
          {
            name: 'README.md',
            path: 'README.md',
            content: '# Personal Notes\n\nThis is a private repository for personal notes and documentation.\n\n## Overview\n\nUse this repository to store personal notes, ideas, and reference materials.\n\n## Categories\n\n- [Study Notes](study/README.md)\n- [Project Ideas](ideas/README.md)\n- [Reference Materials](reference/README.md)',
            type: 'file'
          },
          {
            name: 'study',
            path: 'study',
            type: 'dir',
            children: [
              {
                name: 'README.md',
                path: 'study/README.md',
                content: '# Study Notes\n\nThis directory contains study notes on various topics.\n\n## Topics\n\n- [Web Development](web-development.md)\n- [Machine Learning](machine-learning.md)',
                type: 'file'
              },
              {
                name: 'web-development.md',
                path: 'study/web-development.md',
                content: '# Web Development Notes\n\n## HTML\n\n- Semantic HTML elements\n- Accessibility best practices\n\n## CSS\n\n- Flexbox layout\n- CSS Grid\n- CSS Variables\n\n## JavaScript\n\n- ES6+ features\n- Async/await\n- Promises\n\n## Frameworks\n\n- React\n- Vue\n- Angular\n\n## Resources\n\n- MDN Web Docs\n- CSS-Tricks\n- JavaScript.info',
                type: 'file'
              }
            ]
          }
        ]
      };
    }
    
    if (!repo) {
      showToast('Repository not found', 'error');
      return;
    }
    
    // Update breadcrumb
    updateFileBreadcrumb(path);
    
    // Clear file list
    fileList.innerHTML = '';
    
    // Get files at the current path
    let currentFiles = repo.files;
    let pathParts = path.split('/').filter(Boolean);
    
    // Navigate to the current path
    for (let i = 0; i < pathParts.length; i++) {
      let found = false;
      for (let j = 0; j < currentFiles.length; j++) {
        if (currentFiles[j].type === 'dir' && currentFiles[j].name === pathParts[i]) {
          currentFiles = currentFiles[j].children;
          found = true;
          break;
        }
      }
      if (!found) {
        showToast('Path not found', 'error');
        return;
      }
    }
    
    // Check if there are markdown files
    let hasMarkdownFiles = currentFiles.some(file => 
      file.type === 'file' && file.name.toLowerCase().endsWith('.md')
    );
    
    // Show empty state if no markdown files
    if (currentFiles.length === 0 || !hasMarkdownFiles) {
      welcomeView.classList.add('hidden');
      editorContainer.classList.add('hidden');
      emptyRepoView.classList.remove('hidden');
      return;
    }
    
    // Add "up directory" item if we're in a subdirectory
    if (path) {
      const upDirItem = document.createElement('li');
      upDirItem.className = 'flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700';
      
      const upDirIcon = document.createElement('div');
      upDirIcon.className = 'flex-shrink-0 mr-2';
      
      const upDirSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      upDirSvg.setAttribute('class', 'h-5 w-5 text-gray-400 dark:text-gray-500');
      upDirSvg.setAttribute('fill', 'none');
      upDirSvg.setAttribute('viewBox', '0 0 24 24');
      upDirSvg.setAttribute('stroke', 'currentColor');
      
      const upDirPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      upDirPath.setAttribute('stroke-linecap', 'round');
      upDirPath.setAttribute('stroke-linejoin', 'round');
      upDirPath.setAttribute('stroke-width', '2');
      upDirPath.setAttribute('d', 'M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z');
      
      upDirSvg.appendChild(upDirPath);
      upDirIcon.appendChild(upDirSvg);
      
      const upDirName = document.createElement('span');
      upDirName.className = 'text-gray-700 dark:text-gray-300';
      upDirName.textContent = '..';
      
      upDirItem.appendChild(upDirIcon);
      upDirItem.appendChild(upDirName);
      
      upDirItem.addEventListener('click', function() {
        const parentPath = path.split('/').slice(0, -1).join('/');
        currentPath = parentPath;
        fetchRepositoryFiles(currentRepo, currentBranch, parentPath);
      });
      
      fileList.appendChild(upDirItem);
    }
    
    // Add directories first
    currentFiles.filter(file => file.type === 'dir').forEach(dir => {
      const dirItem = document.createElement('li');
      dirItem.className = 'flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700';
      
      const dirIcon = document.createElement('div');
      dirIcon.className = 'flex-shrink-0 mr-2';
      
      const dirSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      dirSvg.setAttribute('class', 'h-5 w-5 text-gray-400 dark:text-gray-500');
      dirSvg.setAttribute('fill', 'none');
      dirSvg.setAttribute('viewBox', '0 0 24 24');
      dirSvg.setAttribute('stroke', 'currentColor');
      
      const dirPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      dirPath.setAttribute('stroke-linecap', 'round');
      dirPath.setAttribute('stroke-linejoin', 'round');
      dirPath.setAttribute('stroke-width', '2');
      dirPath.setAttribute('d', 'M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z');
      
      dirSvg.appendChild(dirPath);
      dirIcon.appendChild(dirSvg);
      
      const dirName = document.createElement('span');
      dirName.className = 'text-gray-700 dark:text-gray-300';
      dirName.textContent = dir.name;
      
      dirItem.appendChild(dirIcon);
      dirItem.appendChild(dirName);
      
      dirItem.addEventListener('click', function() {
        const newPath = path ? `${path}/${dir.name}` : dir.name;
        currentPath = newPath;
        fetchRepositoryFiles(currentRepo, currentBranch, newPath);
      });
      
      fileList.appendChild(dirItem);
    });
    
    // Then add files
    currentFiles.filter(file => file.type === 'file').forEach(file => {
      const fileItem = document.createElement('li');
      fileItem.className = 'flex items-center justify-between px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700';
      
      const fileContent = document.createElement('div');
      fileContent.className = 'flex items-center';
      
      const fileIcon = document.createElement('div');
      fileIcon.className = 'flex-shrink-0 mr-2';
      
      const fileSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      
      if (file.name.toLowerCase().endsWith('.md')) {
        fileSvg.setAttribute('class', 'h-5 w-5 text-blue-500');
      } else {
        fileSvg.setAttribute('class', 'h-5 w-5 text-gray-400 dark:text-gray-500');
      }
      
      fileSvg.setAttribute('fill', 'none');
      fileSvg.setAttribute('viewBox', '0 0 24 24');
      fileSvg.setAttribute('stroke', 'currentColor');
      
      const filePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      filePath.setAttribute('stroke-linecap', 'round');
      filePath.setAttribute('stroke-linejoin', 'round');
      filePath.setAttribute('stroke-width', '2');
      filePath.setAttribute('d', 'M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z');
      
      fileSvg.appendChild(filePath);
      fileIcon.appendChild(fileSvg);
      
      const fileName = document.createElement('span');
      fileName.className = 'text-gray-700 dark:text-gray-300';
      fileName.textContent = file.name;
      
      fileContent.appendChild(fileIcon);
      fileContent.appendChild(fileName);
      
      // Create file actions (only visible on hover)
      const fileActions = document.createElement('div');
      fileActions.className = 'repo-actions items-center space-x-2';
      
      if (file.name.toLowerCase().endsWith('.md')) {
        // Edit button
        const editButton = document.createElement('button');
        editButton.className = 'p-1 rounded-md text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200';
        editButton.setAttribute('title', 'Edit');
        
        const editSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        editSvg.setAttribute('class', 'h-4 w-4');
        editSvg.setAttribute('fill', 'none');
        editSvg.setAttribute('viewBox', '0 0 24 24');
        editSvg.setAttribute('stroke', 'currentColor');
        
        const editPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        editPath.setAttribute('stroke-linecap', 'round');
        editPath.setAttribute('stroke-linejoin', 'round');
        editPath.setAttribute('stroke-width', '2');
        editPath.setAttribute('d', 'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z');
        
        editSvg.appendChild(editPath);
        editButton.appendChild(editSvg);
        
        editButton.addEventListener('click', function(e) {
          e.stopPropagation();
          openFile(file);
        });
        
        fileActions.appendChild(editButton);
      }
      
      fileItem.appendChild(fileContent);
      fileItem.appendChild(fileActions);
      
      fileItem.addEventListener('click', function() {
        if (file.name.toLowerCase().endsWith('.md')) {
          openFile(file);
        } else {
          showToast('Only Markdown files can be edited', 'info');
        }
      });
      
      fileList.appendChild(fileItem);
    });
    
    // Show editor container or welcome view
    welcomeView.classList.add('hidden');
    emptyRepoView.classList.add('hidden');
    
    // If a file was previously open, keep it open
    if (currentFile) {
      editorContainer.classList.remove('hidden');
    } else {
      // Auto-open README.md if it exists
      const readmeFile = currentFiles.find(file => 
        file.type === 'file' && file.name.toLowerCase() === 'readme.md'
      );
      
      if (readmeFile) {
        openFile(readmeFile);
      } else {
        editorContainer.classList.add('hidden');
        welcomeView.classList.remove('hidden');
      }
    }
    
    showToast('Repository loaded successfully', 'success');
  }, 1000);
}

function updateFileBreadcrumb(path) {
  filePathBreadcrumb.innerHTML = '';
  
  // Create root element
  const rootElement = document.createElement('span');
  rootElement.className = 'cursor-pointer hover:text-gray-900 dark:hover:text-white';
  rootElement.textContent = currentRepo.split('/')[1];
  rootElement.addEventListener('click', function() {
    currentPath = '';
    fetchRepositoryFiles(currentRepo, currentBranch, '');
  });
  
  filePathBreadcrumb.appendChild(rootElement);
  
  // Create path elements
  const pathParts = path.split('/').filter(Boolean);
  
  if (pathParts.length > 0) {
    let currentPath = '';
    
    pathParts.forEach((part, index) => {
      // Add separator
      const separator = document.createElement('span');
      separator.className = 'mx-1';
      separator.textContent = '/';
      filePathBreadcrumb.appendChild(separator);
      
      // Add path part
      const pathElement = document.createElement('span');
      
      if (index === pathParts.length - 1) {
        pathElement.className = 'text-gray-900 dark:text-white';
      } else {
        pathElement.className = 'cursor-pointer hover:text-gray-900 dark:hover:text-white';
      }
      
      pathElement.textContent = part;
      
      if (index < pathParts.length - 1) {
        // Update current path
        currentPath = currentPath ? `${currentPath}/${part}` : part;
        
        // Store the path in a closure
        const pathCopy = currentPath;
        
        pathElement.addEventListener('click', function() {
          fetchRepositoryFiles(currentRepo, currentBranch, pathCopy);
        });
      }
      
      filePathBreadcrumb.appendChild(pathElement);
    });
  }
}

function openFile(file) {
  // Set current file
  currentFile = file;
  
  // Set file name in the editor header
  fileNameInput.value = file.name;
  
  // Show editor container
  welcomeView.classList.add('hidden');
  emptyRepoView.classList.add('hidden');
  editorContainer.classList.remove('hidden');
  
  // Initialize or update editor content
  if (!editor) {
    // Create editor instance
    editor = ace.edit(editorView);
    editor.setTheme(isDarkMode() ? 'ace/theme/monokai' : 'ace/theme/github');
    editor.session.setMode('ace/mode/markdown');
    editor.setShowPrintMargin(false);
    editor.renderer.setShowGutter(true);
    editor.session.setUseWrapMode(true);
    
    // Add change event listener
    editor.on('change', function() {
      // Update preview if visible
      if (!previewView.classList.contains('hidden')) {
        updatePreview();
      }
      
      // Dispatch editor changed event
      document.dispatchEvent(new Event('editorChanged'));
    });
  }
  
  // Set editor content
  editor.session.setValue(file.content);
  
  // Reset modification state
  isFileModified = false;
  document.title = `${file.name} - MD Editor`;
  
  // Show commit container
  commitContainer.classList.remove('hidden');
  
  // Update preview if visible
  if (!previewView.classList.contains('hidden')) {
    updatePreview();
  }
}

function updatePreview() {
  // Get editor content
  const content = editor.getValue();
  
  // Render markdown
  previewContent.innerHTML = marked.parse(content);
}

function togglePreview() {
  if (previewView.classList.contains('hidden')) {
    // Show preview
    editorView.classList.add('hidden');
    previewView.classList.remove('hidden');
    previewToggle.textContent = 'Edit';
    
    // Update preview
    updatePreview();
  } else {
    // Show editor
    editorView.classList.remove('hidden');
    previewView.classList.add('hidden');
    previewToggle.textContent = 'Preview';
  }
}

function saveChanges() {
  // Show commit modal
  commitModal.classList.remove('hidden');
  modalCommitMessage.focus();
}

function handleCommitChanges() {
  // Get commit message
  const message = modalCommitMessage.value.trim();
  
  if (!message) {
    // Show error if no commit message
    showToast('Please enter a commit message', 'error');
    return;
  }
  
  // Close commit modal
  closeCommitModal();
  
  // Show loading state
  showToast('Committing changes...', 'info');
  
  // In a real app, we would send a request to GitHub API
  // For this demo, we'll simulate committing changes
  setTimeout(() => {
    // Update file content in our local data
    currentFile.content = editor.getValue();
    
    // Reset modification state
    isFileModified = false;
    document.title = `${currentFile.name} - MD Editor`;
    
    showToast('Changes committed successfully!', 'success');
  }, 1000);
}

function closeCommitModal() {
  commitModal.classList.add('hidden');
  modalCommitMessage.value = '';
}

function handleLogout() {
  // Remove token from localStorage
  localStorage.removeItem('github_token');
  
  // Show login screen
  loginScreen.classList.remove('hidden');
  ide.classList.add('hidden');
  
  // Reset state
  currentFile = null;
  currentRepo = null;
  currentBranch = 'main';
  currentPath = '';
  isFileModified = false;
  
  showToast('Logged out successfully', 'success');
}

// Demo mode implementation for GitHub Markdown Editor

// Demo data structures
const demoData = {
  repositories: [
    { 
      name: 'demo-project-docs', 
      description: 'Documentation for Demo Project',
      default_branch: 'main'
    },
    { 
      name: 'markdown-notes', 
      description: 'Personal Markdown Notes',
      default_branch: 'main'
    },
    { 
      name: 'blog-posts', 
      description: 'Blog Post Drafts',
      default_branch: 'main'
    }
  ],
  branches: ['main', 'develop', 'feature/new-docs'],
  files: {
    'demo-project-docs': {
      'main': {
        '/': [
          { name: 'README.md', type: 'file', path: 'README.md', content: '# Demo Project Documentation\n\nWelcome to the demo project documentation.\n\n## Getting Started\n\nThis is a placeholder for getting started instructions.\n\n## Features\n\n- Feature 1\n- Feature 2\n- Feature 3\n\n## Contributing\n\nGuidelines for contributing to this project.\n' },
          { name: 'api', type: 'dir', path: 'api' },
          { name: 'guides', type: 'dir', path: 'guides' }
        ],
        '/api': [
          { name: 'api-overview.md', type: 'file', path: 'api/api-overview.md', content: '# API Documentation\n\n## Endpoints\n\n### GET /api/v1/users\n\nReturns a list of users.\n\n### POST /api/v1/login\n\nAuthenticate a user.\n' },
          { name: 'auth.md', type: 'file', path: 'api/auth.md', content: '# Authentication Guide\n\nThis document covers the authentication methods for the API.\n\n## JWT Authentication\n\nThis API uses JSON Web Tokens for authentication.\n' }
        ],
        '/guides': [
          { name: 'getting-started.md', type: 'file', path: 'guides/getting-started.md', content: '# Getting Started Guide\n\nFollow these steps to get started with the project.\n\n## Installation\n\n```bash\nnpm install my-demo-project\n```\n\n## Configuration\n\nCreate a `.env` file with the following variables:\n\n```\nAPI_KEY=your_api_key\nDEBUG=false\n```\n' },
          { name: 'troubleshooting.md', type: 'file', path: 'guides/troubleshooting.md', content: '# Troubleshooting Guide\n\n## Common Issues\n\n### Application won\'t start\n\nCheck if the port is already in use.\n\n### API returns 401\n\nVerify your authentication token is valid and not expired.\n' }
        ]
      }
    },
    'markdown-notes': {
      'main': {
        '/': [
          { name: 'README.md', type: 'file', path: 'README.md', content: '# My Markdown Notes\n\nThis repository contains personal notes written in Markdown.\n' },
          { name: 'web-development', type: 'dir', path: 'web-development' },
          { name: 'ideas.md', type: 'file', path: 'ideas.md', content: '# Project Ideas\n\n## Web Application Ideas\n\n- Task management system\n- Recipe sharing platform\n- Personal finance tracker\n\n## Mobile App Ideas\n\n- Habit tracker\n- Language learning flashcards\n- Hiking trail finder\n' }
        ],
        '/web-development': [
          { name: 'html-basics.md', type: 'file', path: 'web-development/html-basics.md', content: '# HTML Basics\n\n## Document Structure\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Page Title</title>\n</head>\n<body>\n  <h1>This is a Heading</h1>\n  <p>This is a paragraph.</p>\n</body>\n</html>\n```\n' },
          { name: 'css-tricks.md', type: 'file', path: 'web-development/css-tricks.md', content: '# CSS Tricks\n\n## Flexbox Layout\n\n```css\n.container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n```\n\n## CSS Grid\n\n```css\n.grid {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  grid-gap: 20px;\n}\n```\n' },
          { name: 'javascript-notes.md', type: 'file', path: 'web-development/javascript-notes.md', content: '# JavaScript Notes\n\n## Arrow Functions\n\n```javascript\n// Traditional function\nfunction add(a, b) {\n  return a + b;\n}\n\n// Arrow function\nconst add = (a, b) => a + b;\n```\n\n## Promises\n\n```javascript\nfetch(\'https://api.example.com/data\')\n  .then(response => response.json())\n  .then(data => console.log(data))\n  .catch(error => console.error(\'Error:\', error));\n```\n' }
        ]
      }
    },
    'blog-posts': {
      'main': {
        '/': [
          { name: 'README.md', type: 'file', path: 'README.md', content: '# Blog Post Drafts\n\nThis repository contains drafts for blog posts.\n' },
          { name: 'tech', type: 'dir', path: 'tech' },
          { name: 'personal', type: 'dir', path: 'personal' }
        ],
        '/tech': [
          { name: 'react-hooks-guide.md', type: 'file', path: 'tech/react-hooks-guide.md', content: '# A Complete Guide to React Hooks\n\n## Introduction\n\nReact Hooks were introduced in React 16.8 as a way to use state and other React features without writing a class component.\n\n## useState Hook\n\n```jsx\nimport React, { useState } from \'react\';\n\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n## useEffect Hook\n\n```jsx\nimport React, { useState, useEffect } from \'react\';\n\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    document.title = `You clicked ${count} times`;\n  }, [count]);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n' },
          { name: 'typescript-tips.md', type: 'file', path: 'tech/typescript-tips.md', content: '# TypeScript Tips and Tricks\n\n## Type Assertions\n\n```typescript\nconst canvas = document.getElementById(\'canvas\') as HTMLCanvasElement;\n```\n\n## Generics\n\n```typescript\nfunction identity<T>(arg: T): T {\n  return arg;\n}\n\nconst output = identity<string>(\'myString\');\n```\n' }
        ],
        '/personal': [
          { name: 'year-in-review.md', type: 'file', path: 'personal/year-in-review.md', content: '# 2024: Year in Review\n\n## Professional Achievements\n\n- Completed advanced JavaScript certification\n- Contributed to open source projects\n- Improved CI/CD pipeline at work\n\n## Personal Goals\n\n- Read 20 books\n- Learn Spanish\n- Run a half marathon\n' },
          { name: 'book-notes.md', type: 'file', path: 'personal/book-notes.md', content: '# Book Notes\n\n## Atomic Habits by James Clear\n\n### Key Takeaways\n\n- Small habits compound over time\n- Focus on systems rather than goals\n- Make good habits easy and bad habits difficult\n- Identity-based habits are more sustainable\n' }
        ]
      }
    }
  }
};

// Demo user info
const demoUser = {
  login: 'demo-user',
  name: 'Demo User',
  email: 'demo@example.com',
  avatar_url: '/api/placeholder/80/80'
};

// Demo mode state
let isDemoMode = false;
let currentDemoRepo = null;
let currentDemoBranch = 'main';
let currentDemoPath = '/';
let currentDemoFile = null;
let hasUnsavedChanges = false;

// Initialize the demo mode
function initDemoMode() {
  isDemoMode = true;
  
  // Update UI for demo mode
  document.getElementById('ide').classList.remove('hidden');
  document.getElementById('login-screen').classList.add('hidden');
  
  // Set user information
  document.getElementById('user-name').textContent = demoUser.login;
  document.getElementById('user-name').classList.remove('hidden');
  document.getElementById('user-avatar').src = demoUser.avatar_url;
  document.getElementById('dropdown-user-name').textContent = demoUser.name;
  document.getElementById('dropdown-user-email').textContent = demoUser.email;
  
  // Populate repository dropdown
  populateDemoRepos();
  
  // Setup event listeners for demo mode
  setupDemoEventListeners();
}

// Populate repository dropdown with demo data
function populateDemoRepos() {
  const repoDropdownContent = document.getElementById('repo-dropdown-content');
  repoDropdownContent.innerHTML = '';
  
  demoData.repositories.forEach(repo => {
    const repoItem = document.createElement('div');
    repoItem.className = 'repo-item px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer flex justify-between items-center';
    repoItem.dataset.repo = repo.name;
    
    const nameDiv = document.createElement('div');
    nameDiv.textContent = repo.name;
    repoItem.appendChild(nameDiv);
    
    repoDropdownContent.appendChild(repoItem);
    
    repoItem.addEventListener('click', () => selectDemoRepo(repo.name));
  });
}

// Select a demo repository
function selectDemoRepo(repoName) {
  currentDemoRepo = repoName;
  currentDemoBranch = demoData.repositories.find(r => r.name === repoName).default_branch;
  currentDemoPath = '/';
  currentDemoFile = null;
  
  // Update UI
  document.getElementById('current-repo-name').textContent = repoName;
  document.getElementById('repo-dropdown-content').classList.add('hidden');
  
  // Show branch selector
  document.getElementById('branch-selector').classList.remove('hidden');
  document.getElementById('current-branch').textContent = currentDemoBranch;
  
  // Load files for this repo and branch
  loadDemoFiles();
  
  // Hide welcome view and show file UI
  document.getElementById('welcome-view').classList.add('hidden');
  
  // Check if the repository has any markdown files
  const hasMarkdownFiles = checkForMarkdownFiles();
  if (hasMarkdownFiles) {
    document.getElementById('empty-repo-view').classList.add('hidden');
  } else {
    document.getElementById('empty-repo-view').classList.remove('hidden');
    document.getElementById('editor-container').classList.add('hidden');
  }
}

// Check if the repository has any markdown files
function checkForMarkdownFiles() {
  // Recursively check all paths in the repository
  function hasMarkdownInPath(path) {
    const files = demoData.files[currentDemoRepo][currentDemoBranch][path] || [];
    
    for (const file of files) {
      if (file.type === 'file' && file.name.endsWith('.md')) {
        return true;
      } else if (file.type === 'dir') {
        const subPath = path === '/' ? `/${file.name}` : `${path}/${file.name}`;
        if (hasMarkdownInPath(subPath)) {
          return true;
        }
      }
    }
    
    return false;
  }
  
  return hasMarkdownInPath('/');
}

// Load files for the selected demo repository and branch
function loadDemoFiles() {
  const fileList = document.getElementById('file-list');
  fileList.innerHTML = '';
  
  // Update breadcrumb
  updateDemoBreadcrumb();
  
  // Get files for current path
  const files = demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] || [];
  
  // Sort: directories first, then files
  const sortedFiles = [...files].sort((a, b) => {
    if (a.type !== b.type) {
      return a.type === 'dir' ? -1 : 1;
    }
    return a.name.localeCompare(b.name);
  });
  
  // Add parent directory if not at root
  if (currentDemoPath !== '/') {
    const parentItem = document.createElement('li');
    parentItem.className = 'flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
    
    const parentIcon = document.createElement('div');
    parentIcon.className = 'mr-2 text-gray-500 dark:text-gray-400';
    parentIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
    `;
    parentItem.appendChild(parentIcon);
    
    const parentText = document.createElement('span');
    parentText.className = 'text-gray-700 dark:text-gray-300';
    parentText.textContent = '..';
    parentItem.appendChild(parentText);
    
    fileList.appendChild(parentItem);
    
    parentItem.addEventListener('click', navigateToParentDirectory);
  }
  
  // Create list items for all files and directories
  sortedFiles.forEach(file => {
    const fileItem = document.createElement('li');
    fileItem.className = 'flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
    
    const fileIcon = document.createElement('div');
    fileIcon.className = 'mr-2 text-gray-500 dark:text-gray-400';
    
    if (file.type === 'dir') {
      fileIcon.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" />
        </svg>
      `;
    } else {
      if (file.name.endsWith('.md')) {
        fileIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
          </svg>
        `;
      } else {
        fileIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 3a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
          </svg>
        `;
      }
    }
    fileItem.appendChild(fileIcon);
    
    const fileName = document.createElement('span');
    fileName.className = 'text-gray-700 dark:text-gray-300';
    fileName.textContent = file.name;
    fileItem.appendChild(fileName);
    
    fileList.appendChild(fileItem);
    
    // Add event listeners
    if (file.type === 'dir') {
      fileItem.addEventListener('click', () => navigateToDemoDirectory(file.name));
    } else {
      fileItem.addEventListener('click', () => openDemoFile(file));
    }
  });
}

// Update breadcrumb for current path
function updateDemoBreadcrumb() {
  const breadcrumb = document.getElementById('file-path-breadcrumb');
  breadcrumb.innerHTML = '';
  
  const pathParts = currentDemoPath === '/' ? [] : currentDemoPath.split('/').filter(p => p);
  
  // Add root
  const rootLink = document.createElement('span');
  rootLink.className = 'cursor-pointer hover:underline text-gray-700 dark:text-gray-300';
  rootLink.textContent = currentDemoRepo;
  rootLink.addEventListener('click', () => {
    currentDemoPath = '/';
    loadDemoFiles();
  });
  breadcrumb.appendChild(rootLink);
  
  // Add path parts
  let currentPath = '';
  pathParts.forEach((part, index) => {
    breadcrumb.appendChild(document.createTextNode(' / '));
    
    currentPath += '/' + part;
    const partLink = document.createElement('span');
    partLink.className = 'cursor-pointer hover:underline text-gray-700 dark:text-gray-300';
    partLink.textContent = part;
    
    const pathCopy = currentPath; // Create a copy for the closure
    partLink.addEventListener('click', () => {
      currentDemoPath = pathCopy;
      loadDemoFiles();
    });
    
    breadcrumb.appendChild(partLink);
  });
}

// Navigate to parent directory
function navigateToParentDirectory() {
  const pathParts = currentDemoPath.split('/').filter(p => p);
  pathParts.pop();
  currentDemoPath = pathParts.length === 0 ? '/' : '/' + pathParts.join('/');
  loadDemoFiles();
}

// Navigate to a directory
function navigateToDemoDirectory(dirname) {
  currentDemoPath = currentDemoPath === '/' ? `/${dirname}` : `${currentDemoPath}/${dirname}`;
  loadDemoFiles();
}

// Open a file
function openDemoFile(file) {
  if (hasUnsavedChanges) {
    if (!confirm('You have unsaved changes. Do you want to discard them?')) {
      return;
    }
  }
  
  currentDemoFile = file;
  
  // Update UI
  document.getElementById('file-name-input').value = file.name;
  document.getElementById('editor-container').classList.remove('hidden');
  document.getElementById('empty-repo-view').classList.add('hidden');
  
  // Initialize editor if not already done
  if (!window.editor) {
    initializeEditor();
  }
  
  // Set editor content
  window.editor.setValue(file.content);
  window.editor.clearSelection();
  
  // Reset unsaved changes flag
  hasUnsavedChanges = false;
  
  // Update preview if in preview mode
  if (document.getElementById('preview-view').classList.contains('flex')) {
    updatePreview();
  }
}

// Initialize the editor
function initializeEditor() {
  const editorElement = document.getElementById('editor-view');
  
  // Create editor instance
  window.editor = ace.edit(editorElement);
  window.editor.setTheme("ace/theme/github");
  window.editor.session.setMode("ace/mode/markdown");
  window.editor.setShowPrintMargin(false);
  window.editor.setOptions({
    fontSize: "14px",
    fontFamily: "monospace",
    enableBasicAutocompletion: true,
    enableLiveAutocompletion: true,
  });
  
  // Listen for changes
  window.editor.getSession().on('change', () => {
    hasUnsavedChanges = true;
    if (document.getElementById('preview-view').classList.contains('flex')) {
      updatePreview();
    }
  });
  
  // Apply dark mode if needed
  if (document.body.classList.contains('dark-mode')) {
    window.editor.setTheme("ace/theme/monokai");
  }
}

// Update preview content
function updatePreview() {
  const content = window.editor.getValue();
  const previewContent = document.getElementById('preview-content');
  previewContent.innerHTML = marked.parse(content);
}

// Create a new file
function createNewDemoFile(filename) {
  // Validate filename
  if (!filename.trim()) {
    showDemoError('File name cannot be empty');
    return false;
  }
  
  if (!filename.endsWith('.md')) {
    filename += '.md';
  }
  
  // Check if file already exists
  const files = demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] || [];
  if (files.some(f => f.name === filename)) {
    showDemoError('A file with this name already exists');
    return false;
  }
  
  // Create new file object
  const newFilePath = currentDemoPath === '/' ? filename : `${currentDemoPath.substring(1)}/${filename}`;
  const newFile = {
    name: filename,
    type: 'file',
    path: newFilePath,
    content: `# ${filename.replace('.md', '')}\n\nEnter your markdown content here.\n`
  };
  
  // Add to demo data
  if (!demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath]) {
    demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] = [];
  }
  demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath].push(newFile);
  
  // Reload file list
  loadDemoFiles();
  
  // Open the new file
  openDemoFile(newFile);
  
  showToast('success', 'File created successfully');
  return true;
}

// Save changes to current file
function saveDemoChanges(commitMessage) {
  if (!currentDemoFile) return;
  
  // Update file content in demo data
  currentDemoFile.content = window.editor.getValue();
  
  // Reset unsaved changes flag
  hasUnsavedChanges = false;
  
  showToast('success', 'Changes committed successfully');
}

// Toggle preview mode
function toggleDemoPreview() {
  const editorView = document.getElementById('editor-view');
  const previewView = document.getElementById('preview-view');
  const previewToggleBtn = document.getElementById('preview-toggle');
  
  if (previewView.classList.contains('hidden')) {
    // Show preview
    editorView.classList.add('hidden');
    previewView.classList.remove('hidden');
    previewView.classList.add('flex');
    previewToggleBtn.textContent = 'Edit';
    updatePreview();
  } else {
    // Hide preview
    editorView.classList.remove('hidden');
    previewView.classList.remove('flex');
    previewView.classList.add('hidden');
    previewToggleBtn.textContent = 'Preview';
  }
}

// Show toast notification
function showToast(type, message) {
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toast-message');
  const successIcon = document.getElementById('toast-icon-success');
  const errorIcon = document.getElementById('toast-icon-error');
  const infoIcon = document.getElementById('toast-icon-info');
  
  // Set message
  toastMessage.textContent = message;
  
  // Set icon
  successIcon.classList.add('hidden');
  errorIcon.classList.add('hidden');
  infoIcon.classList.add('hidden');
  
  if (type === 'success') {
    successIcon.classList.remove('hidden');
  } else if (type === 'error') {
    errorIcon.classList.remove('hidden');
  } else if (type === 'info') {
    infoIcon.classList.remove('hidden');
  }
  
  // Show toast
  toast.classList.remove('hidden', 'opacity-0', 'translate-y-2');
  toast.classList.add('opacity-100', 'translate-y-0');
  
  // Hide after delay
  setTimeout(() => {
    toast.classList.add('opacity-0', 'translate-y-2');
    setTimeout(() => {
      toast.classList.add('hidden');
    }, 300);
  }, 3000);
}

// Show error in new file modal
function showDemoError(message) {
  const errorElement = document.getElementById('new-file-error');
  errorElement.textContent = message;
  errorElement.classList.remove('hidden');
}

// Setup event listeners for demo mode
function setupDemoEventListeners() {
  // Repository dropdown
  const repoDropdownBtn = document.getElementById('repo-dropdown-btn');
  const repoDropdownContent = document.getElementById('repo-dropdown-content');
  
  repoDropdownBtn.addEventListener('click', () => {
    repoDropdownContent.classList.toggle('hidden');
  });
  
  // Repository selection from welcome screen
  document.getElementById('repo-selection-btn').addEventListener('click', () => {
    repoDropdownContent.classList.toggle('hidden');
  });
  
  // Branch dropdown
  const branchDropdownBtn = document.getElementById('branch-dropdown-btn');
  const branchDropdownContent = document.getElementById('branch-dropdown-content');
  
  branchDropdownBtn.addEventListener('click', () => {
    // Populate branches
    branchDropdownContent.innerHTML = '';
    demoData.branches.forEach(branch => {
      const branchItem = document.createElement('div');
      branchItem.className = 'px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
      branchItem.textContent = branch;
      branchDropdownContent.appendChild(branchItem);
      
      branchItem.addEventListener('click', () => {
        currentDemoBranch = branch;
        document.getElementById('current-branch').textContent = branch;
        branchDropdownContent.classList.add('hidden');
        loadDemoFiles();
      });
    });
    
    branchDropdownContent.classList.toggle('hidden');
  });
  
  // New file button
  document.getElementById('new-file-btn').addEventListener('click', () => {
    document.getElementById('new-file-name').value = '';
    document.getElementById('new-file-error').classList.add('hidden');
    document.getElementById('new-file-modal').classList.remove('hidden');
  });
  
  // Create first file button
  document.getElementById('create-first-file-btn').addEventListener('click', () => {
    document.getElementById('new-file-name').value = '';
    document.getElementById('new-file-error').classList.add('hidden');
    document.getElementById('new-file-modal').classList.remove('hidden');
  });
  
  // Create file confirmation
  document.getElementById('create-file-confirm').addEventListener('click', () => {
    const fileName = document.getElementById('new-file-name').value;
    if (createNewDemoFile(fileName)) {
      document.getElementById('new-file-modal').classList.add('hidden');
    }
  });
  
  // Create file cancel
  document.getElementById('create-file-cancel').addEventListener('click', () => {
    document.getElementById('new-file-modal').classList.add('hidden');
  });
  
  // Save button
  document.getElementById('save-btn').addEventListener('click', () => {
    const commitMsg = document.getElementById('commit-message').value || `Update ${currentDemoFile.name}`;
    saveDemoChanges(commitMsg);
  });
  
  // Preview toggle
  document.getElementById('preview-toggle').addEventListener('click', toggleDemoPreview);
  
  // Refresh files button
  document.getElementById('refresh-files-btn').addEventListener('click', loadDemoFiles);
  
  // Theme toggle
  document.getElementById('theme-toggle').addEventListener('click', toggleDemoTheme);
  
  // User menu toggle
  const userMenuButton = document.getElementById('user-menu-button');
  const userDropdown = document.getElementById('user-dropdown');
  
  userMenuButton.addEventListener('click', () => {
    userDropdown.classList.toggle('hidden');
  });
 
  // Logout button implementation for demo mode
document.getElementById('logout-btn').addEventListener('click', () => {
  // Check for unsaved changes
  if (hasUnsavedChanges) {
    if (!confirm('You have unsaved changes. Are you sure you want to log out?')) {
      return;
    }
  }
  
  // Reset demo state
  isDemoMode = false;
  currentDemoRepo = null;
  currentDemoBranch = 'main';
  currentDemoPath = '/';
  currentDemoFile = null;
  hasUnsavedChanges = false;
  
  // Reset editor if it exists
  if (window.editor) {
    window.editor.setValue('');
    window.editor.clearSelection();
  }
  
  // Show login screen
  document.getElementById('app').classList.add('hidden');
  document.getElementById('login-screen').classList.remove('hidden');
  
  // Hide user dropdown if open
  document.getElementById('user-dropdown').classList.add('hidden');
  
  // Clear any search results or modals
  document.getElementById('search-overlay').classList.add('hidden');
  document.getElementById('new-file-modal').classList.add('hidden');
  document.getElementById('new-repo-modal').classList.add('hidden');
  document.getElementById('new-dir-modal').classList.add('hidden');
  
  // Reset theme to default if needed
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const htmlElement = document.documentElement;
  
  if ((prefersDark && !htmlElement.classList.contains('dark')) || 
      (!prefersDark && htmlElement.classList.contains('dark'))) {
    toggleDemoTheme();
  }
  
  console.log('Logged out of demo mode');
});

// Demo mode implementation for GitHub Markdown Editor (continued)

// Toggle theme for demo mode
function toggleDemoTheme() {
  const htmlElement = document.documentElement;
  const isDark = htmlElement.classList.toggle('dark');
  
  // Update editor theme if editor is initialized
  if (window.editor) {
    window.editor.setTheme(isDark ? "ace/theme/monokai" : "ace/theme/github");
  }
  
  // Update theme toggle button icon
  const themeToggleIcon = document.getElementById('theme-toggle-icon');
  if (isDark) {
    themeToggleIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
      </svg>
    `;
  } else {
    themeToggleIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
      </svg>
    `;
  }
  
  // Save preference to local storage
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
}

// Initialize theme based on preference
function initDemoTheme() {
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  
  if ((savedTheme === 'dark') || (!savedTheme && prefersDark)) {
    document.documentElement.classList.add('dark');
    
    // Update theme toggle button icon
    const themeToggleIcon = document.getElementById('theme-toggle-icon');
    themeToggleIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
      </svg>
    `;
  }
}

// Handle file deletion in demo mode
function deleteDemoFile() {
  if (!currentDemoFile) return;
  
  if (!confirm(`Are you sure you want to delete "${currentDemoFile.name}"?`)) {
    return;
  }
  
  // Find and remove the file from demo data
  const files = demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath];
  const fileIndex = files.findIndex(f => f.name === currentDemoFile.name);
  
  if (fileIndex !== -1) {
    files.splice(fileIndex, 1);
  }
  
  // Reset current file
  currentDemoFile = null;
  
  // Hide editor
  document.getElementById('editor-container').classList.add('hidden');
  
  // Check if repo is now empty
  const hasMarkdownFiles = checkForMarkdownFiles();
  if (!hasMarkdownFiles) {
    document.getElementById('empty-repo-view').classList.remove('hidden');
  }
  
  // Reload file list
  loadDemoFiles();
  
  showToast('success', 'File deleted successfully');
}

// Create a new directory in demo mode
function createDemoDirectory(dirName) {
  // Validate directory name
  if (!dirName.trim()) {
    showDemoError('Directory name cannot be empty');
    return false;
  }
  
  // Check if directory already exists
  const files = demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] || [];
  if (files.some(f => f.name === dirName)) {
    showDemoError('A file or directory with this name already exists');
    return false;
  }
  
  // Create new directory object
  const newDirPath = currentDemoPath === '/' ? `/${dirName}` : `${currentDemoPath}/${dirName}`;
  const newDir = {
    name: dirName,
    type: 'dir',
    path: newDirPath
  };
  
  // Add to demo data
  if (!demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath]) {
    demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] = [];
  }
  demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath].push(newDir);
  
  // Initialize the directory with an empty array
  demoData.files[currentDemoRepo][currentDemoBranch][newDirPath] = [];
  
  // Reload file list
  loadDemoFiles();
  
  showToast('success', 'Directory created successfully');
  return true;
}

// Handle window beforeunload event to warn about unsaved changes
function setupBeforeUnloadHandler() {
  window.addEventListener('beforeunload', (event) => {
    if (isDemoMode && hasUnsavedChanges) {
      const message = 'You have unsaved changes. Are you sure you want to leave?';
      event.returnValue = message;
      return message;
    }
  });
}

// Handle keyboard shortcuts
function setupKeyboardShortcuts() {
  document.addEventListener('keydown', (event) => {
    // Only handle shortcuts if in demo mode
    if (!isDemoMode) return;
    
    // Ctrl/Cmd + S: Save
    if ((event.ctrlKey || event.metaKey) && event.key === 's') {
      event.preventDefault();
      if (currentDemoFile) {
        saveDemoChanges(`Update ${currentDemoFile.name}`);
      }
    }
    
    // Ctrl/Cmd + P: Preview toggle
    if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
      event.preventDefault();
      toggleDemoPreview();
    }
  });
}

// Handle file rename
function renameDemoFile(newName) {
  if (!currentDemoFile) return false;
  
  // Validate new name
  if (!newName.trim()) {
    showDemoError('File name cannot be empty');
    return false;
  }
  
  if (!newName.endsWith('.md')) {
    newName += '.md';
  }
  
  // Check if file with new name already exists
  const files = demoData.files[currentDemoRepo][currentDemoBranch][currentDemoPath] || [];
  if (newName !== currentDemoFile.name && files.some(f => f.name === newName)) {
    showDemoError('A file with this name already exists');
    return false;
  }
  
  // Update file name
  const oldName = currentDemoFile.name;
  currentDemoFile.name = newName;
  
  // Update path
  const pathWithoutFilename = currentDemoFile.path.substring(0, currentDemoFile.path.lastIndexOf('/') + 1);
  currentDemoFile.path = pathWithoutFilename + newName;
  
  // Update UI
  document.getElementById('file-name-input').value = newName;
  
  // Reload file list
  loadDemoFiles();
  
  showToast('success', `Renamed "${oldName}" to "${newName}"`);
  return true;
}

// Handle file name edit
function setupFileNameEditing() {
  const fileNameInput = document.getElementById('file-name-input');
  
  fileNameInput.addEventListener('focus', () => {
    // Store original value for cancel
    fileNameInput.dataset.originalValue = fileNameInput.value;
  });
  
  fileNameInput.addEventListener('blur', () => {
    const newName = fileNameInput.value;
    const originalValue = fileNameInput.dataset.originalValue;
    
    if (newName !== originalValue) {
      if (!renameDemoFile(newName)) {
        // If rename failed, restore original value
        fileNameInput.value = originalValue;
      }
    }
  });
  
  fileNameInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
      fileNameInput.blur();
    } else if (event.key === 'Escape') {
      fileNameInput.value = fileNameInput.dataset.originalValue;
      fileNameInput.blur();
    }
  });
}

// Create a new repository
function createDemoRepository(repoName, description) {
  // Validate repo name
  if (!repoName.trim()) {
    showDemoError('Repository name cannot be empty');
    return false;
  }
  
  // Check if repo already exists
  if (demoData.repositories.some(r => r.name === repoName)) {
    showDemoError('A repository with this name already exists');
    return false;
  }
  
  // Create new repo
  const newRepo = {
    name: repoName,
    description: description || '',
    default_branch: 'main'
  };
  
  // Add to demo data
  demoData.repositories.push(newRepo);
  
  // Initialize repo structure
  demoData.files[repoName] = {
    'main': {
      '/': [
        { 
          name: 'README.md', 
          type: 'file', 
          path: 'README.md', 
          content: `# ${repoName}\n\n${description || 'A new repository.'}\n` 
        }
      ]
    }
  };
  
  // Update repository dropdown
  populateDemoRepos();
  
  // Select the new repo
  selectDemoRepo(repoName);
  
  showToast('success', 'Repository created successfully');
  return true;
}

// Setup new repository modal
function setupNewRepositoryModal() {
  const newRepoBtn = document.getElementById('new-repo-btn');
  const newRepoModal = document.getElementById('new-repo-modal');
  const createRepoConfirm = document.getElementById('create-repo-confirm');
  const createRepoCancel = document.getElementById('create-repo-cancel');
  const newRepoName = document.getElementById('new-repo-name');
  const newRepoDesc = document.getElementById('new-repo-description');
  const newRepoError = document.getElementById('new-repo-error');
  
  // Show modal
  newRepoBtn.addEventListener('click', () => {
    newRepoName.value = '';
    newRepoDesc.value = '';
    newRepoError.classList.add('hidden');
    newRepoModal.classList.remove('hidden');
    newRepoName.focus();
  });
  
  // Create repository
  createRepoConfirm.addEventListener('click', () => {
    if (createDemoRepository(newRepoName.value, newRepoDesc.value)) {
      newRepoModal.classList.add('hidden');
    }
  });
  
  // Cancel
  createRepoCancel.addEventListener('click', () => {
    newRepoModal.classList.add('hidden');
  });
}

// Setup new directory modal
function setupNewDirectoryModal() {
  const newDirBtn = document.getElementById('new-dir-btn');
  const newDirModal = document.getElementById('new-dir-modal');
  const createDirConfirm = document.getElementById('create-dir-confirm');
  const createDirCancel = document.getElementById('create-dir-cancel');
  const newDirName = document.getElementById('new-dir-name');
  const newDirError = document.getElementById('new-dir-error');
  
  // Show modal
  newDirBtn.addEventListener('click', () => {
    newDirName.value = '';
    newDirError.classList.add('hidden');
    newDirModal.classList.remove('hidden');
    newDirName.focus();
  });
  
  // Create directory
  createDirConfirm.addEventListener('click', () => {
    if (createDemoDirectory(newDirName.value)) {
      newDirModal.classList.add('hidden');
    }
  });
  
  // Cancel
  createDirCancel.addEventListener('click', () => {
    newDirModal.classList.add('hidden');
  });
}

// Setup delete file button
function setupDeleteFileButton() {
  const deleteFileBtn = document.getElementById('delete-file-btn');
  
  deleteFileBtn.addEventListener('click', deleteDemoFile);
}

// Set up commit message handling
function setupCommitMessageHandling() {
  const commitMsgInput = document.getElementById('commit-message');
  
  commitMsgInput.addEventListener('focus', () => {
    if (currentDemoFile && !commitMsgInput.value) {
      commitMsgInput.value = `Update ${currentDemoFile.name}`;
    }
  });
}

// Handle search functionality in demo mode
function setupDemoSearch() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  const searchOverlay = document.getElementById('search-overlay');
  
  // Show search overlay
  searchInput.addEventListener('focus', () => {
    searchOverlay.classList.remove('hidden');
  });
  
  // Hide search overlay when clicking outside
  searchOverlay.addEventListener('click', (event) => {
    if (event.target === searchOverlay) {
      searchOverlay.classList.add('hidden');
      searchInput.value = '';
      searchResults.innerHTML = '';
    }
  });
  
  // Handle search input
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim().toLowerCase();
    searchResults.innerHTML = '';
    
    if (!query) return;
    
    // Search for markdown files in all repositories
    const results = [];
    
    Object.keys(demoData.files).forEach(repo => {
      Object.keys(demoData.files[repo]).forEach(branch => {
        // Function to recursively search directories
        function searchDirectory(path) {
          const files = demoData.files[repo][branch][path] || [];
          
          files.forEach(file => {
            if (file.type === 'file' && file.name.endsWith('.md')) {
              // Match by filename or content
              if (file.name.toLowerCase().includes(query) || 
                  (file.content && file.content.toLowerCase().includes(query))) {
                results.push({
                  repo,
                  branch,
                  path: file.path,
                  name: file.name,
                  content: file.content
                });
              }
            } else if (file.type === 'dir') {
              const subPath = path === '/' ? `/${file.name}` : `${path}/${file.name}`;
              searchDirectory(subPath);
            }
          });
        }
        
        searchDirectory('/');
      });
    });
    
    // Display results
    if (results.length > 0) {
      results.slice(0, 10).forEach(result => {
        const resultItem = document.createElement('div');
        resultItem.className = 'p-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
        
        const resultTitle = document.createElement('div');
        resultTitle.className = 'font-medium text-gray-800 dark:text-gray-200';
        resultTitle.textContent = result.name;
        resultItem.appendChild(resultTitle);
        
        const resultPath = document.createElement('div');
        resultPath.className = 'text-sm text-gray-500 dark:text-gray-400';
        resultPath.textContent = `${result.repo} / ${result.path}`;
        resultItem.appendChild(resultPath);
        
        // Add content preview if matched in content
        if (result.content && result.content.toLowerCase().includes(query)) {
          const contentLines = result.content.split('\n');
          let matchLine = contentLines.findIndex(line => 
            line.toLowerCase().includes(query));
          
          if (matchLine !== -1) {
            const previewText = contentLines[matchLine].trim();
            
            const resultPreview = document.createElement('div');
            resultPreview.className = 'text-sm text-gray-600 dark:text-gray-300 mt-1 overflow-hidden overflow-ellipsis whitespace-nowrap';
            resultPreview.textContent = previewText;
            resultItem.appendChild(resultPreview);
          }
        }
        
        searchResults.appendChild(resultItem);
        
        // Add click handler
        resultItem.addEventListener('click', () => {
          // Switch to the repo and branch
          if (currentDemoRepo !== result.repo) {
            currentDemoRepo = result.repo;
            document.getElementById('current-repo-name').textContent = result.repo;
          }
          
          if (currentDemoBranch !== result.branch) {
            currentDemoBranch = result.branch;
            document.getElementById('current-branch').textContent = result.branch;
          }
          
          // Get directory path
          const dirPath = result.path.substring(0, result.path.lastIndexOf('/'));
          currentDemoPath = dirPath ? `/${dirPath}` : '/';
          
          // Load files
          loadDemoFiles();
          
          // Find and open the file
          const files = demoData.files[result.repo][result.branch][currentDemoPath] || [];
          const fileToOpen = files.find(f => f.name === result.name);
          if (fileToOpen) {
            openDemoFile(fileToOpen);
          }
          
          // Hide search overlay
          searchOverlay.classList.add('hidden');
          searchInput.value = '';
          searchResults.innerHTML = '';
        });
      });
    } else {
      const noResults = document.createElement('div');
      noResults.className = 'p-2 text-gray-500 dark:text-gray-400';
      noResults.textContent = 'No results found';
      searchResults.appendChild(noResults);
    }
  });
}

// Setup export functionality in demo mode
function setupDemoExport() {
  const exportBtn = document.getElementById('export-btn');
  
  exportBtn.addEventListener('click', () => {
    if (!currentDemoFile) return;
    
    const content = window.editor.getValue();
    const blob = new Blob([content], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = currentDemoFile.name;
    a.click();
    
    URL.revokeObjectURL(url);
    
    showToast('success', `Exported ${currentDemoFile.name}`);
  });
}

// Full initialization function for demo mode
function initFullDemoMode() {
  initDemoMode();
  initDemoTheme();
  setupFileNameEditing();
  setupBeforeUnloadHandler();
  setupKeyboardShortcuts();
  setupNewRepositoryModal();
  setupNewDirectoryModal();
  setupDeleteFileButton();
  setupCommitMessageHandling();
  setupDemoSearch();
  setupDemoExport();
}

// Global initialization - detect if we should use demo mode
document.addEventListener('DOMContentLoaded', () => {
  const useDemoMode = (new URLSearchParams(window.location.search)).has('demo');
  
  if (useDemoMode) {
    initFullDemoMode();
  }
  
  // Demo mode button in login screen
  document.getElementById('demo-mode-btn').addEventListener('click', () => {
    initFullDemoMode();
  });
});
  

}




</script></body></html>